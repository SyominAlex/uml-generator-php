#!/usr/bin/env php
<?php

if($argc != 2){
    echo 'Usage: json2dot <directory>'.PHP_EOL;
    exit();
}

$directory = $argv[1];

if(!is_dir($directory)){
    echo 'Input directory is not a directory'.PHP_EOL;
}

require_once(__DIR__ . '/../vendor/autoload.php');

use UmlGeneratorPhp\OopToDot;

$toDot = new OopToDot();

$files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($directory));
$files = new RegexIterator($files, '/\.json$/');

foreach($files as $file){
    $array = json_decode(file_get_contents($file));
    $dot = $toDot->getClassDiagram($array);

    $pinfo=pathinfo($file);
    $outputfile = $pinfo['dirname'] . '/' . $pinfo['filename'] . '.dot';
    echo $outputfile . PHP_EOL;
    file_put_contents($outputfile, $dot);

}
